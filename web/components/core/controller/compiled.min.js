GollumJS.Component.Manager.instance().then(function(m){m.registerCompiled({"src":"core:controller","ejs":"<%{\n\t\"js\": [\n\t\t\"Controller.js\",\n\t\t\"AbstractAction.js\"\n\t],\n\t\"class\": \"GollumJS.Component.Controller\"\n}%>\n<div class=\"gjs-controller\" ></div>","js":{"Controller.js":"GollumJS.NS(GollumJS.Component,function(){GollumJS.Component;this.Controller=new GollumJS.Class({Extends:GollumJS.Component.Element,actions:null,_popState:!0,_rootLoaded:!1,beforeRender:function(t){var e=this.getManager().getComponent(\"action:\"+this.getHome());e.load().then(t)[\"catch\"](console.error)},getHome:function(){return this.dom[0].getHome()},onAttached:function(){var t=this,e=this.getCurrentHash();e||(e=this.getHome().root),this.replaceState(\"#\"),this.pushState(\"#\"+e),$(window).on({popstate:function(){if(t._popState){var e=GollumJS.get(\"engine\"),o=t.getCurrentHash();\"\"==o&&(t._rootLoaded&&e.close(),t.pushState(\"#\"+t.getHome())),t.parseUrl()}}}),this.parseUrl()},getCurrentHash:function(){var t=window.location.hash;return t&&\"#\"==t[0]&&(t=t.substr(1)),t},parseUrl:function(){var t=this,e=this.getCurrentHash();if(e==this.getHome()&&(this._rootLoaded=!0),e){console.log(\"Open action:\",e);var o=URI(e).path(!0),n=URI(e).query(!0);this.open(o,n)[\"catch\"](function(){console.warn(\"Error loading action:\",e),t.openDefault()})}else this.openDefault()},openDefault:function(){var t=\"#\"+this.getHome();return t==window.location.hash?void console.error(\"Error loading default action\"):(this.replaceState(t),void this.parseUrl())},replaceState:function(t){history.replaceState(null,null,t)},pushState:function(t){history.pushState(null,null,t)},open:function(t){var e=this,o=t.split(\"/\"),n=o.shift();this.setLoading(!0),this.action&&this.action.remove();var a=this.getManager().getComponent(\"action:\"+n);return a.load().then(function(){var t=$('<gjs-action action=\"'+n+'\" ></gjs-action>');e.dom.bind(\"gjs-render\",function(o,n){n===t[0].GJSElement&&(e.action=n,n.layerManager=e,e.setLoading(!1),n.dom.find(\"> div\").addClass(\"action\"))}),e.dom.find(\"> div.gjs-controller\").append(t)})},setLoading:function(t){t?this.dom.addClass(\"loading\"):this.dom.removeClass(\"loading\")},_bindEventLayer:function(t){var e=this;t.dom.find('a[type=\"back\"]').click(function(t){var o=this.href?this.href:e.options.root;if(o&&\"#\"==o[0]&&(o=o.substr(1)),o){if(t.preventDefault(),e._popState=!1,history.length>1){history.back();var n=e.getCurrentHash();\"\"==n&&e.pushState(o),console.log(\"simple back\")}e.replaceState(o),e.parseUrl(),e._popState=!0}})}})});","AbstractAction.js":"GollumJS.NS(GollumJS.Component,function(){this.AbstractAction=new GollumJS.Class({Extends:GollumJS.Component.Element,layerManager:null,getRequest:function(){var t={dest:URI(window.location.href).path(!0),query:URI(window.location.href).query(!0)},n=window.location.hash;return n&&\"#\"==n[0]&&(n=n.substr(1)),n&&(t.path=n.split(\"/\"),t.action=t.path.shift()),t},getUri:function(){var t=this.getRequest(),n=t.path?\"/\"+t.path.join(\"/\"):\"\";return this.name+n}})});"},"css":{}})});